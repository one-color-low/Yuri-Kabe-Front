<html>
    <head>
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <!-- Bootstrap icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">

        <!-- 追加用 CSS -->
        <link rel="stylesheet" type="text/css" href="style.css">

        <!-- Sign In With Google -->
        <script src="https://accounts.google.com/gsi/client" async defer></script>
        <script>

            function onSignIn(credentialResponse) {
                var credential = document.getElementById("credential")
                credential.value = credentialResponse.credential
            }

            url_obj = new URL(decodeURIComponent(document.location.href))
            room_id = url_obj.searchParams.get("room_id")
            console.log(room_id)
        </script>

    </head>
    <body>

        <div
            id="g_id_onload"
            data-client_id="248112257157-bqfdj7g676v0b9j5m747cveuchoj4p5v.apps.googleusercontent.com"
            data-context="signin"
            data-callback="onSignIn"
            data-auto_select="true"
        ></div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        
        <br>
    
        <div class="container-fluid row">     
            <form id="detail-form" class="col-md-8">

                <!-- id_token -->
                <input type="hidden" name="credential" id="credential" value="dummy-before">

                <label for="input-title" class="yk-box-caption yk-left">タイトル(必須)</label>
                <input id="input-title" name="input-title" class="yk-input-text" type="text">

                <div class="yk-box-space"></div>
                
                <label for="input-description" class="yk-box-caption yk-left">説明</label>
                <input id="input-description" name="input-description" class="yk-input-text-big" type="text">

                <div class="yk-box-space"></div>
                
                <div class="yk-box-caption yk-left">サムネイル</div>

                <div class="container-fluid row">

                    <div class="col-md-5">
                        <label for="input-thumbnail" class="btn">
                            <div class="yk-box-thumbnail">
                                <br>
                                <div class="bi bi-image yk-bi-icon"></div>
                                <p class="center">サムネイルを<br>アップロード</p>
                            </div>
                        </label>
                        <input id="input-thumbnail" type="file">
                    </div>

                    <div class="col-md-5">
                        <label for="select-thumbnail" class="btn">
                            <img class="yk-img-thumbnail" src="./img/miku.webp">
                        </label>
                        <input id="select-thumbnail" type="hidden">
                    </div>

                </div>
            </form>

            <div class="col-md-4">
                <div class="yk-box-separate">
                    <p>プレビュー</p>
                    <!-- todo: canvas設置しプレビュー表示できるように -->
                </div>
                <div class="yk-box-caption yk-left">ルームリンク</div>
                <div class="yk-box-separate-small"></div>
                <div class="yk-box-caption yk-left">ファイル名</div>
                <div class="yk-box-separate-small">
            </div>
        </div>

        <button class="btn btn-primary" id="room-create">ルーム作成</button>

        <script>
            var create_btn = document.getElementById("room-create")
            var detail_form = document.getElementById("detail-form")

            create_btn.onclick = function(){
                var formData = new FormData(detail_form)
                formData.append("room-id", room_id)

                var xhr = new XMLHttpRequest()

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        var status = xhr.status;
                        if (status === 0 || (status >= 200 && status < 400)) {
                            console.log("OK. Status: " + status)
                            window.location=xhr.responseURL //リダイレクトに必要
                        }else{
                            console.log("Error. Status: " + status)
                        }
                    }
                }
                
                xhr.open('POST', '/api/rooms')
                xhr.send(formData)
            }

        </script>


        
    </body>
</html>



